version: '3'

services:
  tmdb-api:
    build: .
    container_name: tmdb-api
    ports:
      - "6635:6635"
    environment:
      # 缓存配置
      - CACHE_DIR=/app/cache
      - CACHE_TTL=3600000            # 缓存过期时间（1小时）
      - MEMORY_CACHE_SIZE=100        # 内存缓存条目数
      - CACHE_MAX_SIZE=1000          # 磁盘缓存最大条目数
      - DISK_CACHE_CLEANUP_INTERVAL=300000    # 磁盘缓存清理间隔（5分钟）
      - MEMORY_CACHE_CLEANUP_INTERVAL=60000   # 内存缓存清理间隔（1分钟）
      
      # 服务器配置
      - PORT=6635
      - REQUEST_TIMEOUT=30000        # 请求超时时间（30秒）
      
      # TMDB配置
      - UPSTREAM_TYPE=tmdb-api       # 上游服务器类型：tmdb-api 或 tmdb-image
      - TMDB_API_KEY=your_api_key    # 替换为你的TMDB API密钥
      - TMDB_IMAGE_TEST_URL=/t/p/original/wwemzKWzjKYJFfCeiB57q3r4Bcm.png
      
      # 负载均衡配置
      - BASE_WEIGHT_MULTIPLIER=20    # 基础权重乘数
      - DYNAMIC_WEIGHT_MULTIPLIER=50 # 动态权重乘数
      - ALPHA_INITIAL=0.5            # 初始alpha值
      - ALPHA_ADJUSTMENT_STEP=0.05   # alpha调整步长
      - MAX_SERVER_SWITCHES=3        # 最大服务器切换次数
      
      # 代理配置（可选）
      - HTTP_PROXY=                  # HTTP代理地址
      - HTTPS_PROXY=                 # HTTPS代理地址
      
      # 其他配置
      - TZ=Asia/Shanghai            # 时区
      - CUSTOM_CONTENT_TYPE=application/json  # 自定义内容类型
      
      # 上游服务器列表
      - UPSTREAM_SERVERS=https://api.themoviedb.org,https://api.tmdb.org,https://tmdb.movie-pilot.org
    volumes:
      - ./cache:/app/cache          # 持久化缓存目录
    restart: unless-stopped
